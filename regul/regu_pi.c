/****************************************************** COMECA *******************************************************
 *  \author		tedie.cedric
 *  \date		6 avr. 2018
 *  \addtogroup	TODO
 *  \{
 ********************************************************************************************************************/
/*********************************************************************************************************************
 *  \file		regu_pi.c
 *  
 *  \brief		TODO
 *
 *  \details	
 *
 ********************************************************************************************************************/

/* Includes --------------------------------------------------------------------------------------------------------*/
#include <stdint.h>
#include <stdbool.h>

#include "regu_pi.h"

/* Macro definition ------------------------------------------------------------------------------------------------*/
/* Constant definition ---------------------------------------------------------------------------------------------*/
/* Type definition  ------------------------------------------------------------------------------------------------*/
/* Public variables ------------------------------------------------------------------------------------------------*/
/* Private variables -----------------------------------------------------------------------------------------------*/
/* Private functions prototypes ------------------------------------------------------------------------------------*/
/* Private functions -----------------------------------------------------------------------------------------------*/
/* Public functions ------------------------------------------------------------------------------------------------*/

/**********************************************************
 * \brief 
 *
 * \param [in]  
 * \param [out]  
 *
 * \return
 *********************************************************/
bool PI_Init(pi_ctrl_t *pi)
{
    pi->_error = 0;
    pi->_error_sum = 0;

    return true;
}

/**********************************************************
 * \brief
 *
 * \param [in]
 * \param [out]
 *
 * \return
 *********************************************************/
void PI_Run(pi_ctrl_t *pi)
{
    pi->_error = *(pi->pConsigne) - *(pi->pMeasure);

    pi->_error_sum += pi->_error;

    pi->output = (pi->Kp * pi->_error) + (pi->Ki * pi->_error_sum);

    if(pi->output > pi->_limit_high)
    {
        pi->output = pi->_limit_high;
    }

    if(pi->output < pi->_limit_low)
    {
        pi->output = pi->_limit_low;
    }
}

/** \} */
/******************************************************** EOF *******************************************************/
